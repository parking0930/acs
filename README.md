# 2021-2 ë¬´ì„ ë„¤íŠ¸ì›Œí¬ í”„ë¡œì íŠ¸ ì¶œì… ê´€ë¦¬ ì‹œìŠ¤í…œ
## í”„ë¡œì íŠ¸ ì†Œê°œ
<table>
    <tr>
        <th>í”„ë¡œì íŠ¸ ëª… </th>
        <th>ì¶œì… ê´€ë¦¬ ì‹œìŠ¤í…œ</th>
        <th>ê°œë°œê¸°ê°„</th>
        <th>2021.11.12 ~ 2021.12.09</th>
    </tr>
    <tr>
        <th>í”„ë¡œì íŠ¸ ì„±ê²©</th>
        <th>ê¸°ë§ê³ ì‚¬</th>
        <th>ê°œë°œì¸ì›</th>
        <th>íŒ€ / 3ëª…<br></th>
    </tr>
      <tr>
        <th>í”„ë¡œì íŠ¸ ê°œìš”</th>
        <th>ë¼ì¦ˆë² ë¦¬íŒŒì´ ì¹´ë©”ë¼ë¥¼ ì´ìš©í•œ ì¶œì… ê´€ë¦¬ ì‹œìŠ¤í…œ</th>
        <th>ê°œë°œí™˜ê²½&nbsp;</th>
        <th>Raspberry Pi</th>
    </tr>
    <tr>
        <th colspan="1">ì‚¬ìš© ë„êµ¬</th>
        <th colspan="3">ì¹´ë©”ë¼ ëª¨ë“ˆ, ë¦´ë ˆì´ ëª¨ë“ˆ, ë„ì–´ë½</th>
    </tr>
    <tr>
        <th>ê°œë°œì–¸ì–´</th>
        <th colspan="3">Python, Spring Framework, MySQL</th>
    </tr>
    <tr>
        <th>í™œìš© ë¼ì´ë¸ŒëŸ¬ë¦¬</th>
        <th colspan="3">OpenCV</th>
    </tr>
    <tr>
        <th>DB ì„œë²„</th>
        <th colspan="3">https://github.com/parking0930/acs_server</th>
    </tr>
    <tr>
        <th>ì‹œì—° ì˜ìƒ</th>
        <th colspan="3">
          https://www.youtube.com/watch?v=39EuufjgfME
        </th>
    </tr>
</table>

### ğŸ“‘ ì—­í•  ë¶„ë‹´
<table>
    <tr>
        <th width="20%">ì—…ë¬´ / <br>êµ¬ì„±ì›</th>
        <th width="25%">ëª¨ì˜í›ˆ</th>
        <th width="25%">ë°•ì¬í˜„</th>
        <th width="25%">ì´ê°•ë¯¼</th>
    </tr>
    <tr>
        <th>í”„ë¡œì íŠ¸ ê¸°íš</th>
        <th colspan="3">ê°œìš”ì‘ì„±,íšŒì˜,ì˜ê²¬ì œì•ˆ</th>
    </tr>
    <tr>
        <th rowspan=2>ì—­í• </th>
        <th>OpenCV ì½”ë“œ ì„¤ê³„<br>ì¹´ë©”ë¼ ëª¨ë“ˆ<br>ë„ì–´ë½ ì—°ê²°<br>DB ì„œë²„ ì—°ë™</th>
        <th>DB ì„œë²„ êµ¬ì¶•(Spring)<br>ì†ŒìŠ¤ ì·¨í•©<br>í…”ë ˆê·¸ë¨ ì—°ë™<br>OpenCV ì½”ë“œ ì„¤ê³„</th>
        <th>DB ì„œë²„ ì—°ë™<br> ì¹´ë©”ë¼ ëª¨ë“ˆ<br> ë„ì–´ë½ ì—°ê²°<br> í…”ë ˆê·¸ë¨ ì—°ë™<br>OpenCV ì½”ë“œ ì„¤ê³„</th>
    </tr>
    <tr>
        <th colspan=3>ìë£Œ ì¡°ì‚¬, ë²„ê·¸ ìˆ˜ì •, ë°œí‘œìë£Œ ì‘ì„±</th>
    </tr>
</table>

### - ì¶œì… ê´€ë¦¬ ì‹œìŠ¤í…œ
  - ì‚¬ëŒ ì¶œì… ì‹œ í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì•Œë¦¼(ë“±ë¡ ì—¬ë¶€, ë“±ë¡ ì •ë³´ ë“±)
  - ì¶œì… ì‹œë§ˆë‹¤ ë°ì´í„°ë² ì´ìŠ¤ì— ì¶œì… ì‹œê°„, ì¶œì…ì ì •ë³´ ë“±ì„ ê¸°ë¡
  - ì‚¬ìš©ìì˜ ì´ë¦„, ì‚¬ì§„ ë“±ì˜ ì •ë³´ë¥¼ ì‚¬ì „ì— í…Œì´ë¸”ì— ë“±ë¡

## ê°œë°œ ëª©í‘œ
### - í”„ë¡œì íŠ¸ ê³„íš
  - python opencv ë¼ì´ë¸ŒëŸ¬ë¦¬ ë˜ëŠ” ë³„ë„ì˜ API í™œìš©
  - ì¶œì… ê¸°ë¡ì„ ì €ì¥í•  ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„±

### - ì‹¤í–‰ ê³¼ì •
    1. ì‚¬ì „ì— ì‚¬ìš©ì ì‚¬ì§„ ë“±ë¡í•˜ì—¬ í•™ìŠµ
    2. ì¸ì²´ê°ì§€(PIR) ì„¼ì„œë¡œ ì‚¬ëŒ ê°ì§€ ì‹œ ì¹´ë©”ë¼ë¥¼ ì¼œê³  ì‚¬ì§„ ì´¬ì˜
    3. ë“±ë¡(ì¸ê°€)ëœ ì‚¬ìš©ìì¸ì§€ íŒë³„(opencv í™œìš©)
    4. ë“±ë¡ëœ ì‚¬ìš©ì ì—¬ë¶€, ì‚¬ìš©ì ì •ë³´, ì´¬ì˜ëœ ì‚¬ì§„ì„ ê´€ë¦¬ì í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì „ì†¡
    5. ì¶œì… ê´€ë ¨ ë°ì´í„°(ì‚¬ìš©ìëª…, ì¸ê°€ ì—¬ë¶€, ì¶œì… ì‹œê°„) í…Œì´ë¸”ì— ê¸°ë¡
    
## í™˜ê²½ êµ¬ì¶•
### - OpenCVì„¤ì¹˜
    1. íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
    sudo apt-get upgrade
    
    2. íŒ¨í‚¤ì§€ ì„¤ì¹˜
    sudo apt-get install build-essential cmake -y
    sudo apt-get install libjpeg-dev libtiff5-dev libjasper-dev libpng12-dev -y
    sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libxvidcore-dev libx264-dev libxine2-dev -y
    sudo apt-get install libv4l-dev v4l-utils -y
    sudo apt-get install libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev -y
    sudo apt-get install libgtk2.0-dev -y
    sudo apt-get install mesa-utils libgl1-mesa-dri libgtkgl2.0-dev libgtkglext1-dev -y
    sudo apt-get install libatlas-base-dev gfortran libeigen3-dev -y
    sudo apt-get install python2.7-dev python3-dev python-numpy python3-numpy -y
  
    3. OpenCV ë‹¤ìš´í•  í´ë” ìƒì„±
    mkdir opencv
    
    4. í´ë” ì´ë™ 
    cd opencv
    
    5. ë‹¤ìš´ ë° ì••ì¶•í•´ì œ
    wget -O opencv.zip https://github.com/opencv/opencv/archive/4.1.2.zip
    unzip opencv.zip
    wget -O opencv_contrib.zip https://github.com/opencv/opencv_contrib/archive/4.1.2.zip
    unzip opencv_contrib.zip
    
    6. í´ë” ì´ë™ ë° ì»´íŒŒì¼
    cd opencv-4.1.2
    
    7. í´ë” ì´ë™ -> cd build
    
    8. OpenCV ì»´íŒŒì¼ ì„¤ì •
    
    9. ì£¼ê¸°ì–µ ì¥ì¹˜ ë©”ëª¨ë¦¬ ì„¤ì • 100 -> 2048
    sudo nano /etc/dphys-swapfile
    sudo /etc/init.d/dphys-swapfile restart
    
    10. ì»´íŒŒì¼
    make -j4
    
    11. ì„¤ì¹˜
    sudo make install
    
    12. openCVë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ì„¤ì •
    sudo ldconfig
    
    13. ë©”ëª¨ë¦¬ ì„¤ì • ë˜ëŒë¦¬ê¸°
    sudo nano /etc/dphys-swapfile
    
    14. ì„¤ì • íŒŒì¼ ì¬ì‹œì‘
    sudo /etc/init.d/dphys-swapfile restart
    
    15. OpenCVëŠ” Haar Featureë¥¼ ì„¤ì¹˜ë¥¼ í•œë‹¤. 
### - í•™ìŠµ ì•Œê³ ë¦¬ì¦˜(Haar Cascade)
Haar Cascadeì˜ íŠ¹ì§•ì€ ê³„ì‚°ì„ í†µí•´ ê°ì²´ë¥¼ ì°¾ì•„ì„œ ì‚¬ì§„ì—ì„œ ì–´ë‘ìš´ ë¶€ë¶„ê³¼ ë°ì€ ë¶€ë¶„ì˜ ì°¨ì´ë¥¼ í†µí•´ ì‚¬ì§„ì˜ íŠ¹ì§•ì„ í•™ìŠµí•˜ëŠ” ë°©ì‹, ê·¸ë ‡ê¸° ë•Œë¬¸ì— íšŒìƒ‰ìœ¼ë¡œ ë³€í™˜ëœ ì‚¬ì§„ì„ ì´ìš©í•˜ë©´ ì—°ì‚°ì˜ ì–‘ì„ ì¤„ì—¬ì¤„ ìˆ˜ ìˆë‹¤.<br>
![ê·¸ë¦¼5](https://user-images.githubusercontent.com/28342911/145423205-3cccc8ac-4488-47c7-9650-92fe93ec660a.png)
![ê·¸ë¦¼6](https://user-images.githubusercontent.com/28342911/145423208-c43de879-e3d1-423b-b422-7b7c76562ea7.png)
<br/>
ì™¼ìª½ì´ Haar CasCade ì˜ íŠ¹ì§• ê²€ì¶œ ë°©ì‹ì´ê³ , ì˜¤ë¥¸ìª½ì´ ì‹¤ ì ìš© ëª¨ìŠµì´ë‹¤. ëˆˆì— ëˆˆì¹ì´ë‚˜ ë™ê³µê°™ì´ ê²€ì€ë¶€ë¶„ì€ ê²€ì€ ì‚¬ê°í˜•ìœ¼ë¡œ ê²€ì¶œë˜ê³ , í”¼ë¶€ëŠ” ë¹„êµì  ë°ìœ¼ë¯€ë¡œ í•˜ì–€ìƒ‰ìœ¼ë¡œ ê²€ì¶œëœë‹¤.
Cascade ë¶„ë¥˜ê¸°ë¥¼ ì‚¬ìš©í•œ ì–¼êµ´ ê²€ì¶œì€ ì–¼êµ´ì´ ê°€ë ¤ì§€ê±°ë‚˜ í•˜ë©´ ì¸ì‹ë¥ ì´ í˜„ì €íˆ ë–¨ì–´ì§€ê¸° ë•Œë¬¸ì— ì–¼êµ´ ì¸ì‹ì—ëŠ” ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì–¼êµ´ ê²€ì¶œì´ ë” ì¢‹ë‹¤.

### - Haar feature-based cascade ì„ ì • ì´ìœ 
 - opencv ë²„ì „ ë¬¸ì œ, ë¼ì¦ˆë² ë¦¬íŒŒì´ ì„±ëŠ¥ ë¬¸ì œë¥¼ ê³ ë ¤í•´ë³´ì•˜ì„ ë•Œ Haar Cascadeê°€ ê°€ì¥ ì í•©í•œ ì•Œê³ ë¦¬ì¦˜ì´ì—ˆìŒ.
<table>
  <tr>
    <td>
      <img src="https://user-images.githubusercontent.com/28342911/145423152-8b212600-e1ed-4166-affb-923133734bc3.jpg" style="width:450px;display:inline-block;">
    </td>
    <td>
      <img src="https://user-images.githubusercontent.com/28342911/145423117-bfd152fe-6747-4e89-adb2-29f099aedc89.jpg" style="width:450px;display:inline-block;">
    </td>
  </tr>
  <tr>
    <td>
      <img src="https://user-images.githubusercontent.com/28342911/145423088-af508b07-d419-4d1f-bfda-fca07c4364c4.jpg" style="width:450px;display:inline-block;">
    </td>
    <td>
      <img src="https://user-images.githubusercontent.com/28342911/145423141-217e29e1-cd9a-4cec-9046-7e51761a139d.jpg" style="width:450px;display:inline-block;">
    </td>
  </tr>
</table>


## ê°œë°œ
- ì‚¬ìš©ì ë“±ë¡ (FaceRegister.py)
<details mardown="1">
    <summary> FaceRegister.py â‘  </summary>
  
~~~python
# ì–¼êµ´ì„ ì €ì¥í•  ë””ë ‰í† ë¦¬
face_dirs = 'faces/'
# haarcascade í•™ìŠµëª¨ë“ˆ ë¡œë“œ
face_classifier = cv2.CascadeClassifier('/home/pi/pj/haarcascades/haarcascade_frontalface_default.xml')
~~~
  
</details>
<details mardown="1">
    <summary> FaceRegister.py â‘¡ </summary>
  
~~~python
if __name__ == "__main__":
    p_number = ""
    # ì‚¬ì§„ ì €ì¥í•  ì´ë¦„ì„ ë„£ì–´ì„œ í•¨ìˆ˜ í˜¸ì¶œ
    while True:
        p_number = input("ì‚¬ì›ë²ˆí˜¸ : ")
        request_data = requests.get("http://172.20.10.5:8081/infoserver/selectAuthorized?id="+p_number)
        info = json.loads(request_data.text)
        if info["authorized"] == None:
            break
        print("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ì›ë²ˆí˜¸ì…ë‹ˆë‹¤.")
    # print(result)

    name = input("í•™ìŠµí•  ì‚¬ëŒì˜ ì´ë¦„ : ")
    position = input("ì§ì±… : ")
    take_pictures(name + "_" + p_number)

    response_data = {"id" : p_number,
                "name" : name,
                "position": position
                }
    result = requests.post("http://172.20.10.5:8081/infoserver/register", data=response_data)
~~~
 
</details>
<br>
- ì¶œì… ê´€ë¦¬ ì‹œìŠ¤í…œ (FaceDetect.py)
<details mardown="1">
    <summary> FaceDetect.py â‘  </summary>
  
~~~python
# ë„ì–´ë½ ì œì–´ GPIO, 14ë²ˆ í•€ ì‚¬ìš© í”„ë¡œê·¸ë¨ ì‹¤í–‰ì‹œ, ì ê²¨ìˆëŠ” ìƒíƒœê°€ Defalutê°€ ë˜ë„ë¡
GPIO.setmode(GPIO.BCM)
GPIO.setup(14, GPIO.OUT, initial=GPIO.HIGH)
bot = telegram.Bot(token='2063832595:AAHXOcez_70VveYrHl9c7xoRJuJ7SphoRAo')  # í…”ë ˆê·¸ë¨ ë´‡ ì—°ê²° í‚¤
chat_id = 2078275327
# ì–¼êµ´ ì¸ì‹ìš© haarcascade ë¡œë”©
face_classifier = cv2.CascadeClassifier('./haarcascades/haarcascade_frontalface_default.xml') 
~~~
  
</details>
<details mardown="1">
    <summary> FaceDetect.py â‘¡ </summary>
  
~~~python
if __name__ == "__main__":
    # í•™ìŠµ ì‹œì‘
    models = trains()
    # ì‹œì‘
    run(models)
~~~
 
</details>

</details>
<details mardown="1">
    <summary> FaceDetect.py â‘¢ </summary>
  
~~~python
def trains():
    #faces í´ë”ì˜ í•˜ìœ„ í´ë”ë¥¼ í•™ìŠµ
    data_path = 'faces/'
    # í´ë”ë§Œ ìƒ‰ì¶œ
    model_dirs = [f for f in listdir(data_path) if isdir(join(data_path,f))]
    
    #í•™ìŠµ ëª¨ë¸ ì €ì¥í•  ë”•ì…”ë„ˆë¦¬
    models = {}
    # ê° í´ë”ì— ìˆëŠ” ì–¼êµ´ë“¤ í•™ìŠµ
    for model in model_dirs:
        print('model :' + model)
        # í•™ìŠµ ì‹œì‘
        result = train(model)
        # í•™ìŠµì´ ì•ˆë˜ì—ˆë‹¤ë©´ íŒ¨ìŠ¤!
        if result is None:
            continue
        # í•™ìŠµë˜ì—ˆìœ¼ë©´ ì €ì¥
        print('model2 :' + model)
        models[model] = result

    # í•™ìŠµëœ ëª¨ë¸ ë”•ì…”ë„ˆë¦¬ ë¦¬í„´
    return models   
~~~
 
</details>
<details mardown="1">
    <summary> FaceDetect.py â‘£ </summary>
  
~~~python
# ì‚¬ìš©ì ì–¼êµ´ í•™ìŠµ
def train(name):
    data_path = 'faces/' + name + '/'
    #íŒŒì¼ë§Œ ë¦¬ìŠ¤íŠ¸ë¡œ ë§Œë“¬
    face_pics = [f for f in listdir(data_path) if isfile(join(data_path,f))]
    
    Training_Data, Labels = [], []
    
    # ì‚¬ìš©ìì˜ ì‚¬ì§„ì„ ë¶ˆëŸ¬ì˜´
    for i, files in enumerate(face_pics):
        image_path = data_path + face_pics[i]
        images = cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)
        # ì´ë¯¸ì§€ê°€ ì•„ë‹ˆë©´ íŒ¨ìŠ¤
        if images is None:
            continue    
        Training_Data.append(np.asarray(images, dtype=np.uint8))
        Labels.append(i)
    # í•™ìŠµí•  ë°ì´í„°(ì´ë¯¸ì§€)ê°€ ì—†ìœ¼ë©´ í•¨ìˆ˜ ì¢…ë£Œ
    if len(Labels) == 0:
        print("í•™ìŠµí•  ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.")
        return None
    # Lables ë¥¼ 32ë¹„íŠ¸ ì •ìˆ˜ë¡œ ë³€í™˜í•¨
    Labels = np.asarray(Labels, dtype=np.int32)
    # ëª¨ë¸ ìƒì„±
    model = cv2.face.LBPHFaceRecognizer_create()
    # í•™ìŠµ
    model.train(np.asarray(Training_Data), np.asarray(Labels))
    print(name + " : ëª¨ë¸ í•™ìŠµ ì™„ë£Œ")

    #í•™ìŠµ ëª¨ë¸ ë¦¬í„´
    return model
~~~
 
</details>
<details mardown="1">
    <summary> FaceDetect.py â‘¤ </summary>
  
~~~python
    def run(models):    
    #ì¹´ë©”ë¼ ì—´ê¸° 
    cap = cv2.VideoCapture(0)
    try:
        while True:
            #ì¹´ë©”ë¼ë¡œ ë¶€í„° ì‚¬ì§„ í•œì¥ ì½ê¸° 
            ret, frame = cap.read()
            # ì–¼êµ´ ê²€ì¶œ ì‹œë„ 
            image, face = face_detector(frame)
            try:            
                min_score = 999       #ì˜ˆì¸¡ëœ ì‚¬ëŒì¼ í™•ë¥ 
                min_score_name = ""   #ì˜ˆì¸¡ëœ ì‚¬ëŒì˜ ì´ë¦„
            
                #ê²€ì¶œëœ ì‚¬ì§„ì„ í‘ë°±ìœ¼ë¡œ ë³€í™˜ 
                face = cv2.cvtColor(face, cv2.COLOR_BGR2GRAY)

                #ìœ„ì—ì„œ í•™ìŠµí•œ ëª¨ë¸ë¡œ ì˜ˆì¸¡ì‹œë„
                for key, model in models.items():
                    result = model.predict(face)                
                    #result[1] ì— ë“¤ì–´ê°€ëŠ” ê°’ì€ ì‹ ë¢°ë„ ì„
                    if min_score > result[1]:
                        min_score = result[1]
                        min_score_name = key
                    
                # 0ì— ê°€ê¹Œìš¸ ìˆ˜ë¡ ì •í™•í•˜ë‹¤.         
                if min_score < 500:
                    # ì •í™•ë„ 
                    confidence = int(100*(1-(min_score)/300))
                    # ìœ ì‚¬ë„ í™”ë©´ì— í‘œì‹œ 
                    display_string = str(confidence)+'% Confidence it is ' + min_score_name
                cv2.putText(image,display_string,(100,120), cv2.FONT_HERSHEY_COMPLEX,1,(250,120,255),2)
                
                #80 ë³´ë‹¤ í¬ë©´ ë™ì¼ ì¸ë¬¼ë¡œ ê°„ì£¼í•´ UnLocked! 
                if confidence > 80:
                    cv2.putText(image, "Unlocked : " + min_score_name, (250, 450), cv2.FONT_HERSHEY_COMPLEX, 1, (0, 255, 0), 2)
                    cv2.imshow('Face Cropper', image)
                    
                    # ì €ì¥í•  íŒŒì¼ì˜ ê²½ë¡œì™€ ì´ë¦„ì§€ì •
                    now = str(datetime.now().strftime('%Y-%m-%d %H:%M'))
                    file_list = os.listdir('./Save')
                    # ì¤‘ë³µëœ ì‚¬ì§„ì´ ìˆëŠ”ì§€ ê²€ì‚¬ìš© ë³€ìˆ˜
                    exist_person = False
                    for filename in file_list:
                        if filename == (min_score_name+'|'+now+'.jpg'):
                            print("ì´ë¯¸ ìˆëŠ” ì‚¬ì§„")
                            exist_person = True
                            break
                    if exist_person:
                        continue
                    # ì´ë¦„_ì‚¬ì›ë²ˆí˜¸ë¥¼ _ ê¸°ì¤€ìœ¼ë¡œ ë¶„ë¦¬
                    p_name = min_score_name.split('_')[0]
                    uid = min_score_name.split('_')[1]
                    # ì¸ì¦ëœ ì‚¬ìš©ìì´ë¯€ë¡œ ë„ì–´ë½ ì—´ê¸°
                    GPIO.output(14, GPIO.LOW)
                    #í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì‚¬ì§„ ì „ì†¡ (ì¸ì¦ëœ ì‚¬ìš©ì)
                    cap_name = min_score_name+'|'+now + ".jpg"
                    cv2.imwrite('./Save/'+cap_name, frame)
                    bot.sendPhoto(chat_id=chat_id,photo=open('./Save/'+cap_name,'rb'))
                    log_text = 'ì‚¬ì›ë²ˆí˜¸:'+uid+'\nì´ë¦„:'+p_name
                    bot.send_message(chat_id=chat_id, text=log_text) 
                
                #80 ì´í•˜ë©´ íƒ€ì¸.. Locked!!!
                else:
                    for filename in file_list:
                        if filename == ('X|'+now+'.jpg'):
                            print("ì´ë¯¸ ìˆëŠ” ì‚¬ì§„")
                            exist_person = True
                            break
                    if exist_person:
                        continue
                    #í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì‚¬ì§„ ì „ì†¡ (ë¹„ì¸ê°€ ì‚¬ìš©ì)
                    cap_name = 'X|'+now + ".jpg"
                    cv2.imwrite('./Save/'+cap_name, frame)
                    bot.sendPhoto(chat_id=chat_id,photo=open('./Save/'+cap_name,'rb'))
                    log_text = 'ì¸ê°€ë˜ì§€ ì•Šì€ ì‚¬ìš©ì ë°œê²¬!'
                    bot.send_message(chat_id=chat_id, text=log_text) 
                    cv2.putText(image, "Locked", (250, 450), cv2.FONT_HERSHEY_COMPLEX, 1, (0, 0, 255), 2)
                    cv2.imshow('Face Cropper', image)

            #ì–¼êµ´ ê²€ì¶œ ì•ˆë¨ 
            except:
                cv2.putText(image, "Face Not Found", (250, 450), cv2.FONT_HERSHEY_COMPLEX, 1, (255, 0, 0), 2)
                cv2.imshow('Face Cropper', image)
                pass
            #Enter ì…ë ¥ìœ¼ë¡œ í”„ë¡œê·¸ë¨ ì¢…ë£Œ
            if cv2.waitKey(1)==13:
                break
        #ì¹´ë©”ë¼ ë„ê¸°
        cap.release()
        #ì—´ë ¤ìˆëŠ” ì°½ ë‹«ê¸°
        cv2.destroyAllWindows()
    except KeyboardInterrupt:
        GPIO.cleanup()
~~~
 
</details>
<details mardown="1">
    <summary> FaceDetect.py â‘¤ </summary>
  
~~~python
def face_detector(img, size = 0.5):
        gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
        faces = face_classifier.detectMultiScale(gray,1.3,5)
        if faces is():
            return img,[]
        for(x,y,w,h) in faces:
            cv2.rectangle(img, (x,y),(x+w,y+h),(0,255,255),2)
            roi = img[y:y+h, x:x+w]
            roi = cv2.resize(roi, (200,200))
        return img,roi   #ê²€ì¶œëœ ì¢Œí‘œì— ì‚¬ê° ë°•ìŠ¤ ê·¸ë¦¬ê³ (img), ê²€ì¶œëœ ë¶€ìœ„ë¥¼ ì˜ë¼(roi) ì „ë‹¬
~~~
 
</details>
    
## í•œê³„ì 
- í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì¸ê°€ ì—¬ë¶€ ë° ì •ë³´ë¥¼ ë³´ëƒˆìœ¼ë‚˜ DBë¡œ ë³´ë‚´ëŠ” ë¶€ë¶„ì€ ë¬¸ì œê°€ ìƒê²¨ í•˜ì§€ ëª»í•˜ì˜€ìŒ. 
![1](https://user-images.githubusercontent.com/28342911/145446239-44bcf6ef-4460-4191-af80-d169d3946507.JPG)
